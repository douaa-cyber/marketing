<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
     @media screen and (min-width: 800px){
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
    
    header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 10000;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    header .logo {
        height: 50px;
    }
    
    .container {
        width: 90%;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-top: 100px;  
        overflow-x: auto; 
    }

    .search-container input[type="text"] {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 4px 0 0 4px;
        width: 80%;
        margin-right: -1px;
    }

    .search-sort {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .search-sort input[type="text"] {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 4px 0 0 4px;
        width: 300px;
        margin-right: -1px; 
    }

    .search-sort button {
        padding: 16px 20px;
        border: 1px solid #ddd;
        border-radius: 0 4px 4px 0;
        background-color: #007bff;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-right: 20px; 
    }

    .search-sort button:hover {
        background-color: #0056b3;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        table-layout: fixed;
    }

    th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        white-space: nowrap; 
    }

    th {
        background-color: #f8f8f8;
        min-width: 150px; 
    }

    td {
        min-width: 150px; 
        max-width: 300px; 
        overflow: hidden; 
        text-overflow: ellipsis; 
    }

    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
        overflow-y: hidden;
        overflow-x: auto;
        white-space: nowrap;
        max-width: 800px;
        margin-left: 15%; 
    }

    .pagination a {
        margin: 0 5px;
        padding: 8px 12px;
        border: 1px solid #007bff;
        border-radius: 4px;
        color: #007bff;
        text-decoration: none;
        cursor: pointer;
    }

    .pagination a.active {
        background-color: #007bff;
        color: white;
    }

    .main-div {
        display: flex;
        justify-content: center;
    }

    #tableContainer {
        display: flex;
        flex-direction: column;
        max-height: 400px;
        overflow-x: auto;
        margin-left:10px;
        margin-right:20px;
    }

    #tableHead {
        display: table;
        width: 100%;
        table-layout: fixed;
    }

    #tableBody {
        display: block;
        max-height: 300px;
        overflow-y: auto;
        width: 100%;
    }

    #tableBody table {
        table-layout: fixed;
        width: 100%;
    }

    #tableBody tr {
        display: table;
        width: 100%;
        table-layout: fixed;
    }
  }
    
  @media(min-width: 800px) {
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        header .logo {
            height: 50px;
        }

        .container {
            width: 90%;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 100px;
            overflow-x: auto;
            border: 1px solid #ddd;
        }

        .search-container input[type="text"] {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            width: 80%;
            margin-right: -1px;
        }

        .search-sort {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-sort input[type="text"] {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            width: 300px;
            margin-right: -1px;
        }

        .search-sort button {
            padding: 16px 20px;
            border: 1px solid #ddd;
            border-radius: 0 4px 4px 0;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-right: 20px;
        }

        .search-sort button:hover {
            background-color: #0056b3;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed;
            border: 1px solid #ddd;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            white-space: nowrap;
        }

        th {
            background-color: #f8f8f8;
            min-width: 150px;
           
        }

        td {
            min-width: 150px;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        td button a {
            color: white;
            text-decoration: none;
        }

        td button {
            padding: 5px 10px;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        td button:hover {
            background-color: #0056b3;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            overflow-y: hidden;
            overflow-x: auto;
            white-space: nowrap;
            max-width: 800px;
            margin-left: 15%;
        }

        .pagination a {
            margin: 0 5px;
            padding: 8px 12px;
            border: 1px solid #007bff;
            border-radius: 4px;
            color: #007bff;
            text-decoration: none;
            cursor: pointer;
        }

        .pagination a.active {
            background-color: #007bff;
            color: white;
        }

        .main-div {
            display: flex;
            justify-content: center;
        }

        #tableContainer {
            display: flex;
            flex-direction: column;
            max-height: 400px;
            overflow-x: auto;
            margin-left: 10px;
            margin-right: 20px;
        }

        #tableHead {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        #tableBody {
            display: block;
            max-height: 300px;
            overflow-y: auto;
            width: 100%;
        }

        #tableBody table {
            table-layout: fixed;
            width: 100%;
        }

        #tableBody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
    }

    @media screen and (max-width: 800px) {
      table {
            width: 100%;
           background-color: white;
        }

        th,
        td {
            text-align: left;
            padding: 8px;
        }
        th{
          border-bottom: 2px solid black;
        }
        #tableContainer {
            overflow-x: auto;
            margin-top: 60px;
            border: 2px solid black;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 90px;
            overflow-y: hidden;
            overflow-x: auto;
            white-space: nowrap;
            max-width: 800px;
            margin-left: 10%;
            
        }

        .pagination a {
            margin: 0 5px;
            padding: 8px 12px;
            border: 1px solid #007bff;
            border-radius: 4px;
            color: #007bff;
            text-decoration: none;
            cursor: pointer;
        }

        .pagination a.active {
            background-color: #007bff;
            color: white;
        }

        .search-container input[type="text"] {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            width: 80%;
            margin-right: -1px;
        }

        .main-div {
           
            margin-top: 40%;
            height: 450px;
            background-color: rgba(218, 218, 213, 0.628);
            border: 1px solid black;
        }

        .search-sort {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            margin-top: 10px;
            margin-left: 10px;
        }

        .search-sort input[type="text"] {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            width: 200px;
            margin-right: -1px;
        }

        .search-sort button {
            padding: 10px 16px;
            border: 1px solid #ddd;
            border-radius: 0 4px 4px 0;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-right: 20px;
        }

        .search-sort button:hover {
            background-color: #0056b3;
        }
       
    }
   
</style>
</head>
<body>
<header>
    <a href="/"><img class="logo" src="../bmsLogo.svg" /></a>
</header>
<div class="main-div">
    <div class="container">
        <div class="search-sort">
            <div class="search-container">
                <input type="text" placeholder="Search" id="searchInput">
                <span class="clear-search" onclick="clearSearch()">×</span>
            </div>
            <button onclick="search()">Search</button>
        </div>

        <div id="tableContainer">
            <table id="tableHead">
                <thead>
                    <tr>
                        <th>Nom Client</th>
                        <th>Prénom Client</th>
                        <th>Date</th>
                        <th>Wilaya</th>
                        <th>Objectif</th>
                        <th>Nom Agent</th>
                        <th>Prénom Agent</th>
                        <th>Détails</th>
                    </tr>
                </thead>
            </table>
            <div id="tableBody">
                <table>
                    <tbody id="tableContent">
                       
                        <% formulaires.forEach(function(formulaire) { %>
                            <tr>
                                <td data-label="Nom Client"><%= formulaire.nom_client %></td>
                                <td data-label="Prénom Client"><%= formulaire.prenom_client %></td>
                                <td data-label="Date"><%= new Date(formulaire.date).toLocaleDateString() %></td>
                                <td data-label="Wilaya"><%= formulaire.wilaya %></td>
                                <td data-label="Objectif"><%= formulaire.objectif_de_mission %></td>
                                <td data-label="Nom Agent"><%= formulaire.nom_agent %></td>
                                <td data-label="Prénom Agent"><%= formulaire.prenom_agent %></td>
                                <td data-label="Détails">
                                  <button data-id="<%= formulaire.id %>"">Détails</button>
                              </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
            </div>
    <div class="pagination">
      <% if (page > 1) { %>
        <a href="/dashboard?page=<%= page - 1 %>&perPage=<%= perPage %>">«</a>
      <% } %>
      
      <% for (let i = 1; i <= Math.ceil(totalCount / perPage); i++) { %>
        <% if (i === page) { %>
          <a href="/dashboard?page=<%= i %>&perPage=<%= perPage %>" class="active"><%= i %></a>
        <% } else { %>
          <a href="/dashboard?page=<%= i %>&perPage=<%= perPage %>"><%= i %></a>
        <% } %>
      <% } %>
    
      <% if (page < Math.ceil(totalCount / perPage)) { %>
        <a href="/dashboard?page=<%= page + 1 %>&perPage=<%= perPage %>">»</a>
      <% } %>
    </div>
  </div>
</div>
<script>
// Fonction de recherche et mise en évidence
function search() {
    const searchString = document.getElementById('searchInput').value.trim().toLowerCase();
    const tableRows = document.getElementById('tableBody').getElementsByTagName('tr');
    localStorage.setItem('searchString', searchString); // Store the search string

    for (let row of tableRows) {
        let matchFound = false;
        const cells = row.getElementsByTagName('td');

        for (let cell of cells) {
            const cellText = cell.textContent.toLowerCase();
            if (cellText.includes(searchString)) {
                cell.innerHTML = cellText.replace(new RegExp(searchString, 'gi'), match => `<span style="background-color: yellow;">${match}</span>`);
                matchFound = true;
            } else {
                cell.innerHTML = cellText; // Reset any previous highlights
            }
        }

        row.style.display = matchFound ? '' : 'none';
    }

    attachDetailButtons(); // Re-attach events to buttons after search
}

// Fonction pour attacher les événements aux boutons de détails
function attachDetailButtons() {
    const buttons = document.querySelectorAll('button[data-id]');
    buttons.forEach(button => {
        button.addEventListener('click', function () {
            const id = button.getAttribute('data-id');
            showDetails(id);
        });
    });
}

// Fonction pour afficher les détails
function showDetails(id) {
    alert('Show details for ID: ' + id);
    // Vous pouvez remplacer cette ligne par votre logique de détails.
}

// Fonction pour mettre en évidence les résultats de recherche
function highlightSearch() {
    const searchString = localStorage.getItem('searchString');
    if (!searchString) return;

    document.getElementById('searchInput').value = searchString; // Restore search input

    const tableRows = document.getElementById('tableBody').getElementsByTagName('tr');

    for (let row of tableRows) {
        let matchFound = false;
        const cells = row.getElementsByTagName('td');

        for (let cell of cells) {
            const cellText = cell.textContent.toLowerCase();
            if (cellText.includes(searchString)) {
                cell.innerHTML = cellText.replace(new RegExp(searchString, 'gi'), match => `<span style="background-color: yellow;">${match}</span>`);
                matchFound = true;
            } else {
                cell.innerHTML = cellText; // Reset any previous highlights
            }
        }

        row.style.display = matchFound ? '' : 'none';
    }

    attachDetailButtons(); // Re-attach events to buttons after highlighting
}

// Fonction pour effacer la recherche
function clearSearch() {
    document.getElementById('searchInput').value = '';
    localStorage.removeItem('searchString'); // Remove the stored search string
    // Reset table to show all rows
    const tableRows = document.getElementById('tableBody').getElementsByTagName('tr');
    for (let row of tableRows) {
        row.style.display = '';
        const cells = row.getElementsByTagName('td');
        for (let cell of cells) {
            cell.innerHTML = cell.textContent;
        }
    }

    attachDetailButtons(); // Re-attach events to buttons after clearing search
}

// Initial attachment of events
window.onload = function () {
    highlightSearch(); // Call highlightSearch on page load
    attachDetailButtons(); // Attach events to buttons on page load

    const urlParams = new URLSearchParams(window.location.search);
    const sortBy = urlParams.get('sortBy');

    if (sortBy) {
        localStorage.setItem('sortBy', sortBy);
    } else {
        sortBy = localStorage.getItem('sortBy');
    }

    if (sortBy) {
        const sortOptions = document.getElementById('sortOptions');
        const buttons = sortOptions.getElementsByTagName('button');

        // Remove active class from all buttons
        for (let button of buttons) {
            button.classList.remove('active');
        }

        // Add active class to the correct button based on sortBy
        switch (sortBy) {
            case 'nomClient':
                buttons[0].classList.add('active');
                break;
            case 'date':
                buttons[1].classList.add('active');
                break;
            case 'nomAgent':
                buttons[2].classList.add('active');
                break;
            case 'wilaya':
                buttons[3].classList.add('active');
                break;
            default:
                break;
        }
    }
}


  </script>
</body>
</html>
